---
title: "NPT Data Visualization"
author: "Sophia LeBlanc"
format:
  html:
    fig-number: true
---

## fig-number helps auto-update figure names/#s

## This report will walk through plotting and visualizing data from the NPT Project in Base R and `ggplot2`.

---

##^ Quarto section break

### Set Up Environment
*This section sets up our environment and data frame.*

#### Load Packages
```{r}
if (!require("pacman")) {install.packages("pacman"); require("pacman")}
p_load("ggplot2")
```

#### Load `study_level_processed` data frame as `npt_data`
```{r}
npt_data <- read.csv(here::here("data/cleaned/study_level_processed.csv"))
```

#### Examples

```{r}
#| label: fig-example
#| fig-cap: "Example figure caption generated by Quarto."
plot(1:10, 1:10)
```

The mean value is `r mean(1:10)` Â± `r sd(1:10)` units (@fig-example).

```{r}
ggplot(data_frame, aes(x = variable_x, y = variable_y)) +
  geom_layer()
```

#### Histograms
*A histogram displays the distribution of one numeric variable.*

Basic Histogram
```{r}
#| label: fig-rt-hist
#| fig-cap: "Histogram of overall reaction times."

ggplot(npt_data, aes(x = mean_rt_overall)) +
  geom_histogram(binwidth = 5,
                 fill = "gray80",
                 color = "black") +
  labs(x = "Mean RT (ms)", y = "Count")
```
---

Histogram with Mean and SD
```{r}
#| label: fig-rt-hist-lines
#| fig-cap: "Histogram of overall reaction times with reference lines showing the mean and one standard deviation."

## Compute summary statistics
mean_rt <- mean(npt_data$mean_rt_overall, na.rm = TRUE)
sd_rt   <- sd(npt_data$mean_rt_overall,   na.rm = TRUE)

## Histogram with reference lines
ggplot(npt_data, aes(x = mean_rt_overall)) +
  geom_histogram(binwidth = 5,
                 fill = "gray80",
                 color = "black") +
  geom_vline(xintercept = mean_rt,         color = "red") +
  geom_vline(xintercept = mean_rt - sd_rt, color = "blue", linetype = "dashed") +
  geom_vline(xintercept = mean_rt + sd_rt, color = "blue", linetype = "dashed") +
  labs(x = "Mean RT (ms)", y = "Count")
```

The mean overall reaction time was `r round(mean_rt, 2)` ms,  and the standard deviation was `r round(sd_rt, 2)` ms.

---

The mean overall reaction time was `r round(mean_rt, 2)` ms,  and the standard deviation was `r round(sd_rt, 2)` ms.

---

#### Scatterplot
*Scatterplots show the relationship between two numeric variables.*

Simple Scatterplot
```{r}
#| label: fig-scatter
#| fig-cap: "Scatterplot of TEF-10 scores and overall reaction times."

ggplot(npt_data, aes(x = tef10_score, y = mean_rt_overall)) +
  geom_point(color = "gray40") +
  labs(x = "TEF-10 Score",
       y = "Mean RT (ms)") +
  theme_minimal()
```
---

Scatterplot with Regression Line
```{r}
#| label: fig-scatter-line
#| fig-cap: "Scatterplot with a fitted regression line showing the relationship between TEF-10 score and overall reaction time."

## Correlation test
cor_test <- cor.test(npt_data$tef10_score,
                     npt_data$mean_rt_overall)

## Scatterplot + regression line
ggplot(npt_data, aes(x = tef10_score, y = mean_rt_overall)) +
  geom_point(color = "gray40") +
  geom_smooth(method = "lm", se = TRUE, color = "blue") +
  labs(x = "TEF-10 Score",
       y = "Mean RT (ms)") +
  theme_minimal()
```

The correlation was `r round(cor_test$estimate, 2)`, with a p-value of `r signif(cor_test$p.value, 3)`.

---

To add themes: `+ theme_classic()`

#### Bar Plots
*Bar plots are used to compare group-level summaries.*

Simple Bar Plot
```{r}
#| label: fig-bar
#| fig-cap: "Mean overall reaction time by focus group."

## Compute group means
mean_rt_by_group <- aggregate(mean_rt_overall ~ focus_group,
                              data = npt_data,
                              FUN  = mean)

mean_rt_by_group

## Extract values for dynamic reporting
mean_high <- mean_rt_by_group$mean_rt_overall[mean_rt_by_group$focus_group == "High Focus"]
mean_low  <- mean_rt_by_group$mean_rt_overall[mean_rt_by_group$focus_group == "Low Focus"]

## Plot the bar plot
ggplot(mean_rt_by_group, aes(x = focus_group, y = mean_rt_overall)) +
  geom_col(fill = "steelblue") +
  labs(x = "Focus Group", y = "Mean RT (ms)") +
  theme_classic()
```

The High Focus group had an average RT of `r round(mean_high, 2)` ms, and the Low Focus group averaged `r round(mean_low, 2)` ms.

---

#### Multi-Group Bar Plots
*Bar plots with multiple bars per group allow us to compare several variables at once.*

Prepare Data
```{r}
## Select relevant columns
multi_rt <- npt_data[, c("focus_group",
                         "parity_mean_rt",
                         "magnitude_mean_rt")]

## Reshape to 'long' format for ggplot
multi_rt_long <- reshape(multi_rt,
                         varying = list(c("parity_mean_rt", "magnitude_mean_rt")),
                         v.names = "rt_value",
                         timevar = "task_type",
                         times = c("Parity RT", "Magnitude RT"),
                         direction = "long")

head(multi_rt_long)

## for multiple variables, multiple conditions

```

Multi-Group Bar Plot
```{r}
#| label: fig-multi-bar
#| fig-cap: "Comparison of parity and magnitude mean RTs across focus groups."

ggplot(multi_rt_long,
       aes(x = focus_group,
           y = rt_value,
           fill = task_type)) +
  geom_col(position = "dodge") +
  labs(x = "Focus Group",
       y = "Mean RT (ms)",
       fill = "Task Type") +
  theme_classic()

## gg handles this splitting better in long format

```

```{r}
tapply(multi_rt_long$rt_value,
       list(multi_rt_long$focus_group,
            multi_rt_long$task_type),
       mean)
```

#### Saving the last plot
```{r}
ggsave(
  filename = here::here("output", "plots", "last_plot.png"),
  width = 6,
  height = 4
)
```

^ Saves most recent figure in document

#### Saving a named plot
```{r}
## Create a plot object
p_focus <- ggplot(mean_rt_by_group,
                  aes(x = focus_group, y = mean_rt_overall)) +
  geom_col(fill = "steelblue") +
  labs(x = "Focus Group", y = "Mean RT (ms)") +
  theme_minimal()

## Save the plot object
ggsave(
  filename = here::here("output", "plots", "focus_group_barplot.png"),
  plot     = p_focus,
  width    = 6,
  height   = 4
)

p_focus   # this displays the plot in the rendered document
print(p_focus)

```

```{r}
ggsave(
  filename = here::here("output", "plots", "focus_group_barplot_highres.png"),
  plot     = p_focus,
  width    = 6,
  height   = 4,
  dpi      = 300
)
```

```{r}
ggsave(
  filename = here::here("output", "plots", "focus_group_barplot.pdf"),
  plot     = p_focus,
  width    = 6,
  height   = 4
)
```